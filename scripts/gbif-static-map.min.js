/**
 *  GBIF Static map widget thing v0.1
 *  No dependencies, (hopefully) no conflicts.
 */
NodeList.prototype.forEach=NodeList.prototype.forEach||Array.prototype.forEach;if(!window.addEventListener)window.addEventListener=window.attachEvent;window.gbifStaticMap=window.gbifStaticMap||(function(D){var b={zoomLevel:0,top:0,right:0,bottom:0,left:1,pointsStyle:'classic.point',tilesStyle:'gbif-classic',taxonKey:1,dataUrl:'https://api.gbif.org/v2/map/occurrence/density/',tileUrl:'https://tile.gbif.org/3857/omt/',speciesUrl:'http://api.gbif.org/v1/species/',gbifUrl:'https://www.gbif.org/species/',projection:3857},m=[],g=function(a,b){var x=new XMLHttpRequest();x.onload=b;x.open("GET",a);x.send()},c=function(a){if(typeof Object.assign=='function')return Object.assign({},a);var o={};for(var p in a){if (a.hasOwnProperty(p))o[p]=a[p];}return o},I=function(e){e.target.setAttribute('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=')},A=function(){if (!document.querySelector('#gbif-static-map-css')){var s=document.createElement('STYLE');s.setAttribute('id','gbif-static-map-css');s.textContent='.gbif-static-map *{box-sizing:border-box;}.gbif-static-map div{margin:0;padding:0;border:0;}.gbif-static-map img{display:inline-block;vertical-align:bottom;background-size:cover;background-repeat:no-repeat;min-height:0;min-width:0;height:100%;width:100%;margin:-0.5px;}';document.head.appendChild(s)}},map=function(a){var s=c(b),C=a.querySelector('.caption'),t=[],d,T,w,h,S,k,T,B,j,i;for (k in a.dataset){if(k=='topLeft'){T=(a.dataset[k]+',0').split(',').map(function(n){return parseInt(n,10)});s.left=T[0];s.top=T[1]}else if(k=="bottomRight"){B=(a.dataset[k]+',0').split(',').map(function(n){return parseInt(n,10)});s.right=B[0];s.bottom=B[1]}if(Object.keys(s).indexOf(k)>=0){s[k]=a.dataset[k]}}w=100/(1+s.right-s.left),h=100/(1+s.bottom-s.top);for(j=s.top;j<=s.bottom;j++){d=D.createElement('div');for(i=s.left;i<=s.right;i++){T=D.createElement('img');T.onerror=I;S=s.dataUrl+s.zoomLevel+'/'+i+'/'+j+'@1x.png?style='+s.pointsStyle+'&srs=EPSG:'+s.projection+'&taxonKey='+s.taxonKey;if(s.pointsStyle.match('poly'))S+='&bin=hex';T.setAttribute('src',S);T.setAttribute('style','background-image:url('+s.tileUrl+s.zoomLevel+'/'+i+'/'+j+'@1x.png?style='+s.tilesStyle+');max-width:'+w+'%;');d.setAttribute('style','max-height:'+h+'%;');d.appendChild(T);t.push(T)}if(C)a.insertBefore(d,C);else a.appendChild(d)}if(C&&C.classList.contains('auto-caption')){g(s.speciesUrl+s.taxonKey,function(){if(this.readyState==4&&[200,301,302].indexOf(this.status)>=0&&this.responseText){try{C.innerHTML='GBIF:<a href="'+s.gbifUrl+s.taxonKey+'">'+(JSON.parse(this.responseText)).scientificName+'</a>'}catch(e){console.log("Species lookup",e)}}})}return {container:a,settings:s}}
return{init:function(){D.querySelectorAll('.gbif-static-map').forEach(function(element){m.push(map(element));});if(map.length)A()},maps:m}})(document)
window.addEventListener('load',window.gbifStaticMap.init)